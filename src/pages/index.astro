---
import Ad from '../components/Ad';
import ads from '../data/ads.json';

// Select a random ad
const selectedAd = ads[Math.floor(Math.random() * ads.length)];

// Define tracking functions
const trackImpression = async (adId) => {
  try {
    await fetch('/api/track-impression', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ adId })
    });
  } catch (error) {
    console.error('Error tracking impression:', error);
  }
};

const trackClick = async (adId) => {
  try {
    await fetch('/api/track-click', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ adId })
    });
  } catch (error) {
    console.error('Error tracking click:', error);
  }
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ads Engine with Astro</title>
</head>
<body>
  <h1>Welcome to My Website</h1>
  
  <section>
    <h2>Sponsored Ad</h2>
    <Ad ad={selectedAd} onImpression={trackImpression} onClick={trackClick} client:load />
  </section>
  
  <!-- Your content goes here -->
</body>
</html>
